<style>
  .sql-post pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 16px;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 13px;
    line-height: 1.5;
    margin: 16px 0;
  }
  .sql-post code {
    font-family: 'SF Mono', Consolas, monospace;
  }
  .sql-post .inline-code {
    background: #f0f0f0;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
  }
  .sql-post .quote-table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 14px;
  }
  .sql-post .quote-table th,
  .sql-post .quote-table td {
    padding: 12px 8px;
    border: 1px solid #ddd;
    text-align: left;
  }
  .sql-post .quote-table th {
    background: #f5f5f5;
  }
  .sql-post .mistake {
    background: #fff3f3;
    border-left: 4px solid #ff6b6b;
    padding: 12px 16px;
    margin: 16px 0;
  }
  .sql-post .tip {
    background: #f0fff4;
    border-left: 4px solid #4ade80;
    padding: 12px 16px;
    margin: 16px 0;
  }
  @media (max-width: 600px) {
    .sql-post pre {
      font-size: 11px;
      padding: 12px;
    }
    .sql-post .quote-table {
      font-size: 12px;
    }
    .sql-post .quote-table th,
    .sql-post .quote-table td {
      padding: 8px 6px;
    }
  }
</style>

<div class="sql-post">

<h2>오늘 배운 것</h2>
<p>DATEDIFF, CASE WHEN, 다중 정렬 배웠다. 그리고 콤마랑 싸웠다.</p>

<h2>DATEDIFF - 날짜 차이</h2>
<pre><code>-- 두 날짜 사이 일수 계산
SELECT DATEDIFF('2025-07-11', '2025-06-20');
-- 결과: 21

-- 입사한지 며칠?
SELECT lastname, hiredate,
       DATEDIFF(NOW(), hiredate) AS 근무일수
FROM employee;</code></pre>
<p><strong>순서:</strong> DATEDIFF(끝 날짜, 시작 날짜) = 앞 - 뒤</p>

<h2>CASE WHEN - 조건별 값</h2>
<pre><code>-- 긴 버전 (모든 비교 가능)
SELECT
    total,
    CASE
        WHEN total < 5 THEN 'low'
        WHEN total < 10 THEN 'medium'
        ELSE 'high'
    END AS level
FROM invoice;</code></pre>

<pre><code>-- 짧은 버전 (= 비교만 가능!)
SELECT
    genreid,
    CASE genreid
        WHEN 1 THEN 'Rock'
        WHEN 2 THEN 'Jazz'
        ELSE 'Other'
    END AS genre_name
FROM track;</code></pre>

<table class="quote-table">
  <tr>
    <th>문법</th>
    <th>사용 가능</th>
  </tr>
  <tr>
    <td><code class="inline-code">CASE WHEN 조건</code></td>
    <td>=, LIKE, >, < 다 됨</td>
  </tr>
  <tr>
    <td><code class="inline-code">CASE 컬럼 WHEN 값</code></td>
    <td>= 만 됨</td>
  </tr>
</table>

<h2>ORDER BY 정렬 응용</h2>
<pre><code>-- CASE로 커스텀 정렬 순서
SELECT customerid, firstname, Country
FROM customer
ORDER BY
    CASE Country
        WHEN 'France' THEN 1
        WHEN 'Canada' THEN 2
        ELSE 3
    END;

-- 다중 정렬 (1차, 2차)
ORDER BY city, lastname;
-- city로 먼저 정렬, 같은 city 안에서 lastname 정렬</code></pre>

<h2>콤마 규칙</h2>
<table class="quote-table">
  <tr>
    <th>상황</th>
    <th>콤마</th>
  </tr>
  <tr>
    <td>SELECT 안 컬럼 나열</td>
    <td>O</td>
  </tr>
  <tr>
    <td>ORDER BY 정렬 기준 나열</td>
    <td>O</td>
  </tr>
  <tr>
    <td>절(FROM, WHERE 등) 앞</td>
    <td>X</td>
  </tr>
</table>

<div class="tip">
<strong>꿀팁:</strong> 콤마를 앞에 쓰면 빠뜨린 게 바로 보임
<pre><code>SELECT
    col1
    ,col2      -- 콤마가 앞에!
    ,col3
FROM table</code></pre>
</div>

<h2>오늘의 삽질 기록</h2>

<div class="mistake">
<strong>콤마 누락 (5회)</strong>
<pre><code>-- 틀림
SELECT lastname DATEDIFF(...)

-- 맞음
SELECT lastname, DATEDIFF(...)</code></pre>
</div>

<div class="mistake">
<strong>따옴표 안 닫음</strong>
<pre><code>-- 틀림
DATEDIFF('2025-07-11,'2025-06-20')

-- 맞음
DATEDIFF('2025-07-11', '2025-06-20')</code></pre>
</div>

<div class="mistake">
<strong>ELSE = 3</strong>
<pre><code>-- 틀림
ELSE = 3

-- 맞음 (= 필요 없음)
ELSE 3</code></pre>
</div>

<div class="mistake">
<strong>WHEN 컬럼명 누락</strong>
<pre><code>-- 틀림
WHEN <5 THEN 'low'

-- 맞음
WHEN total < 5 THEN 'low'</code></pre>
</div>

<div class="mistake">
<strong>와일드카드 * 대신 %</strong>
<pre><code>-- 틀림 (SQL 아님)
LIKE '서울*'

-- 맞음
LIKE '서울%'</code></pre>
</div>

<div class="mistake">
<strong>datedift 오타</strong>
<p>... ㅋㅋ</p>
</div>

<div class="mistake">
<strong>3then 띄어쓰기 없음</strong>
<pre><code>-- 틀림
WHEN 3then'c'

-- 맞음
WHEN 3 THEN 'c'</code></pre>
</div>

<div class="mistake">
<strong>FROM 뒤에 콤마</strong>
<pre><code>-- 틀림
FROM employee,
ORDER BY ...

-- 맞음
FROM employee
ORDER BY ...</code></pre>
</div>

<div class="mistake">
<strong>CASE WHEN 컬럼명 누락 (2)</strong>
<pre><code>-- 틀림
CASE WHEN 'sales support agent' THEN ...

-- 맞음
CASE WHEN title = 'sales support agent' THEN ...</code></pre>
</div>

<div class="mistake">
<strong>COUNT (*) 공백</strong>
<pre><code>-- 틀림
COUNT (*)

-- 맞음
COUNT(*)</code></pre>
</div>

<div class="mistake">
<strong>SELECT * + 집계함수</strong>
<pre><code>-- 틀림
SELECT * COUNT(*) AS total

-- 맞음 (둘 중 하나만)
SELECT COUNT(*) AS total</code></pre>
</div>

<h2>단위 변환</h2>

<h3>시간 변환 (milliseconds)</h3>
<table class="quote-table">
  <tr>
    <th>변환</th>
    <th>계산</th>
  </tr>
  <tr>
    <td>밀리초 → 초</td>
    <td><code class="inline-code">÷ 1000</code></td>
  </tr>
  <tr>
    <td>밀리초 → 분</td>
    <td><code class="inline-code">÷ 1000 ÷ 60</code></td>
  </tr>
</table>

<pre><code>-- 밀리초 → 초
SELECT ROUND(milliseconds / 1000, 2) AS seconds FROM track;

-- 밀리초 → 분
SELECT ROUND(milliseconds / 1000 / 60, 2) AS minutes FROM track;</code></pre>

<h3>용량 변환 (bytes)</h3>
<table class="quote-table">
  <tr>
    <th>변환</th>
    <th>계산</th>
  </tr>
  <tr>
    <td>bytes → KB</td>
    <td><code class="inline-code">÷ 1024</code></td>
  </tr>
  <tr>
    <td>bytes → MB</td>
    <td><code class="inline-code">÷ 1024 ÷ 1024</code></td>
  </tr>
  <tr>
    <td>bytes → GB</td>
    <td><code class="inline-code">÷ 1024 ÷ 1024 ÷ 1024</code></td>
  </tr>
</table>

<pre><code>-- 트랙 전체 용량 (MB)
SELECT
    ROUND(SUM(bytes) / 1024 / 1024, 2) AS total_MB,
    ROUND(AVG(bytes) / 1024 / 1024, 2) AS avg_MB
FROM track;</code></pre>

<h2>집계 함수</h2>
<pre><code>SELECT
    COUNT(*) AS total_track,
    SUM(milliseconds) AS total_ms,
    ROUND(AVG(milliseconds)/1000, 2) AS avg_sec,
    ROUND(MIN(milliseconds)/1000, 2) AS min_sec,
    ROUND(MAX(milliseconds)/1000/60, 2) AS max_min,
    ROUND(SUM(bytes)/1024/1024, 2) AS total_MB
FROM track;</code></pre>

<table class="quote-table">
  <tr>
    <th>함수</th>
    <th>의미</th>
  </tr>
  <tr>
    <td><code class="inline-code">COUNT(*)</code></td>
    <td>전체 행 수</td>
  </tr>
  <tr>
    <td><code class="inline-code">COUNT(컬럼)</code></td>
    <td>NULL 제외 개수</td>
  </tr>
  <tr>
    <td><code class="inline-code">COUNT(DISTINCT 컬럼)</code></td>
    <td>중복 제거 개수</td>
  </tr>
  <tr>
    <td><code class="inline-code">SUM()</code></td>
    <td>합계</td>
  </tr>
  <tr>
    <td><code class="inline-code">AVG()</code></td>
    <td>평균</td>
  </tr>
  <tr>
    <td><code class="inline-code">MIN() / MAX()</code></td>
    <td>최소 / 최대</td>
  </tr>
</table>

<div class="tip">
<strong>주의:</strong> 함수랑 괄호 사이에 공백 넣으면 에러!
<pre><code>COUNT (*)  -- ❌ 에러
COUNT(*)   -- ✅ 정상</code></pre>
</div>

<p><strong>결론: SQL은 엄격하다. 콤마 하나, 따옴표 하나가 목숨이다.</strong></p>

</div>
